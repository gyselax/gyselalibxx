<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Advection Field finder - GyselalibX</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Advection Field finder";
        var mkdocs_page_input_path = "src/geometryRTheta/advection_field/README.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> GyselalibX
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">General</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >First Steps</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../docs/first_steps/getting_started.html">Getting Started</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Installation</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../docs/first_steps/install.html">Gyselalib++ Installation</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../toolchains/index.html">Pre-made build settings</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../docs/first_steps/DDC_in_gyselalibxx.html">DDC in Gyselalib++</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Standards</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../docs/standards/CODING_STANDARD.html">Coding Standard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../docs/standards/mathematical_and_physical_conventions.html">Math & Physics</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Gyselalib++</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Source</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../index.html">Gyselalib++ contents</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >advection</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../advection/index.html">Advection methods</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >collisions</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../collisions/index.html">Collisions</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >data_types</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../data_types/index.html">Data Storage Types</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >geometryRTheta</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../index.html">Geometry (r, theta)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >advection</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../advection/index.html">Advection operator</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" >advection_field</a>
    <ul class="current">
                <li class="toctree-l4 current"><a class="reference internal current" href="#">Advection Field finder</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >geometry</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../geometry/index.html">Geometry RTheta</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >initialisation</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../initialisation/index.html">Initialisation</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >poisson</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../poisson/index.html">Polar Poisson solver</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >time_solver</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../time_solver/index.html">Predictor-corrector methods</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >geometryVparMu</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../geometryVparMu/index.html">Geometry (vpar, mu)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >collisions</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryVparMu/collisions/index.html">CollisionConfiguration</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >geometry</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryVparMu/geometry/index.html">GeometryVparMu</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >initialisation</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryVparMu/initialisation/index.html">Initialisation methods</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >geometryXVx</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../geometryXVx/index.html">Geometry (x, v_x)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >boltzmann</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXVx/boltzmann/index.html">Boltzmann solver</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >geometry</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXVx/geometry/index.html">Geometry X-Vx</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >initialisation</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXVx/initialisation/index.html">Initialisation methods</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >poisson</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXVx/poisson/index.html">Quasi-Neutrality Solver</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >rhs</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXVx/rhs/index.html">RHS</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >time_integration</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXVx/time_integration/index.html">Time integration</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >utils</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXVx/utils/index.html">Utils</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >geometryXY</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../geometryXY/index.html">Geometry (x, y)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >geometry</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXY/geometry/index.html">Geometry XY</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >initialisation</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXY/initialisation/index.html">Initialisation on (x,y) geometry</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >time_integration</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXY/time_integration/index.html">Predictor-corrector methods</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >geometryXYVxVy</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../geometryXYVxVy/index.html">Geometry (x, y, v_x, v_y)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >geometry</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXYVxVy/geometry/index.html">Geometry X Y-Vx Vy</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >initialisation</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXYVxVy/initialisation/index.html">Initialisation methods</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >poisson</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXYVxVy/poisson/index.html">Quasi-Neutrality Solver</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >time_integration</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXYVxVy/time_integration/index.html">Time integration</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >vlasov</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../geometryXYVxVy/vlasov/index.html">Vlasov solver</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >interpolation</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../interpolation/index.html">Interpolation Methods</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >polar_splines</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../interpolation/polar_splines/index.html">Polar Splines</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >io</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../io/index.html">Functions used for input and output</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >mapping</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../mapping/index.html">Mappings</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >math_tools</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../math_tools/index.html">Utility Functions</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >matrix_tools</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../matrix_tools/index.html">Matrix tools</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >mpi_parallelisation</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../mpi_parallelisation/index.html">Parallelisation</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >multipatch</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../multipatch/index.html">Multipatch</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >connectivity</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../multipatch/connectivity/index.html">Multipatch connectivity</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >data_types</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../multipatch/data_types/index.html">Data Types for Multipatch Geometry</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >spline</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../multipatch/spline/index.html">Spline on multipatch geometry</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >utils</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../multipatch/utils/index.html">Multipatch utilitary functions</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >pde_solvers</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../pde_solvers/index.html">PDE Solvers</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >quadrature</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../quadrature/index.html">Quadrature Methods</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >speciesinfo</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../speciesinfo/index.html">SpeciesInfo (x, v_x)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >timestepper</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../timestepper/index.html">Time Stepping Methods</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >utils</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/index.html">Utility Functions</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Simulations</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../simulations/index.html">Gyselalib++ simulations</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >geometryRTheta</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../simulations/geometryRTheta/index.html">Simulations in (r, theta) geometry</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >diocotron</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../simulations/geometryRTheta/diocotron/index.html">Diocotron instability</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >vortex_merger</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../simulations/geometryRTheta/vortex_merger/index.html">Vortex merger</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >geometryXVx</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../simulations/geometryXVx/index.html">Simulations in (x, vx) geometry</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >geometryXY</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../simulations/geometryXY/index.html">Simulations in (x, y) geometry</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >guiding_centre</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../simulations/geometryXY/guiding_centre/index.html">Guiding centre (X,Y) simulation</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Tests</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../tests/index.html">Gyselalib++ tests</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >advection</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../tests/advection/index.html">Tests on the templated advection operators</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >geometryRTheta</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../tests/geometryRTheta/index.html">Tests : Geometry (r, theta)</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >advection_rtheta</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../tests/geometryRTheta/advection_rtheta/index.html">Tests on the 2D polar advection operator</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >polar_poisson</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../tests/geometryRTheta/polar_poisson/index.html">Tests on the 2D polar poisson solver</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >spline_interpolator_rtheta</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../tests/geometryRTheta/spline_interpolator_rtheta/index.html">Tests on spline interpolator in polar coordinates</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >multipatch</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../tests/multipatch/index.html">Multipatch geometry tests</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >geometries</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../tests/multipatch/geometries/index.html">Multipatch geometries</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../docs/development/Adding_docs.html">Adding Docs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../docs/development/Using_git.html">Using Git</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../docs/development/developer_FAQ.html">Developer FAQ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Troubleshooting</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../docs/troubleshooting/Common_compilation_problems.html">Compilation Issues</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Gyselalib++</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" >Classes</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../gyselalibxx/annotated.html">Class List</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../gyselalibxx/classes.html">Class Index</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../gyselalibxx/hierarchy.html">Class Hierarchy</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Namespaces</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../gyselalibxx/namespaces.html">Namespace List</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../gyselalibxx/namespace_members.html">Namespace Members</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../gyselalibxx/namespace_member_functions.html">Namespace Member Functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../gyselalibxx/namespace_member_variables.html">Namespace Member Variables</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../gyselalibxx/namespace_member_typedefs.html">Namespace Member Typedefs</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../gyselalibxx/namespace_member_enums.html">Namespace Member Enumerations</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../gyselalibxx/functions.html">Functions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../gyselalibxx/variables.html">Variables</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../gyselalibxx/macros.html">Macros</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../gyselalibxx/files.html">Files</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">GyselalibX</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Gyselalib++</li>
          <li class="breadcrumb-item">Source</li>
          <li class="breadcrumb-item">geometryRTheta</li>
          <li class="breadcrumb-item">advection_field</li>
      <li class="breadcrumb-item active">Advection Field finder</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/gyselax/gyselalibxx/edit/master/docs/src/geometryRTheta/advection_field/README.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div><h1 id="advection-field-finder">Advection Field finder</h1>
<p>The operator implemented here is a previous step to the advection operator.
It computes the advection field along the axes in the physical domain or the axes in the logical domain.</p>
<p>Currently, the implemented case is:</p>
<ul>
<li>Guiding centre equations system.</li>
</ul>
<h2 id="guiding-centre-case">Guiding centre case</h2>
<p>The studied equation system is of the following type :</p>
<div class="arithmatex">\[
\left\{
\begin{aligned}
\partial_t \rho + A\cdot\nabla \rho = 0, \\
A = E \wedge e_z, \\
E = - \nabla  \phi, \\
- \nabla \cdot \nabla \phi = \rho,
\end{aligned}
\right.
\]</div>
<p>with <span class="arithmatex">\(\rho\)</span> the density, <span class="arithmatex">\(\phi\)</span> the electrostatic potential and <span class="arithmatex">\(E\)</span> the electrical field.</p>
<p>The AdvectionFieldFinder computes the advection field <span class="arithmatex">\(A\)</span> from the electrical field <span class="arithmatex">\(\phi\)</span> returned by the PolarSplineFEMPoissonLikeSolver.
It has two types of <code>operator()</code>:</p>
<ul>
<li>one returning the advection field expressed on the vectors <span class="arithmatex">\((e_x, e_y)\)</span> of the physical domain: <span class="arithmatex">\(A = A_x e_x + A_y e_y\)</span></li>
<li>and another returning the advection field expressed on the vectors <span class="arithmatex">\((e^r, e^\theta)\)</span> of the <a href="../../../docs/standards/mathematical_and_physical_conventions.html">contravariant basis</a> on the logical domain: <span class="arithmatex">\(A = A^r e_r + A^\theta e_\theta\)</span>.</li>
</ul>
<p>The PolarSplineFEMPoissonLikeSolver can return the solution <span class="arithmatex">\(\phi\)</span> of the PDE under two forms:</p>
<ul>
<li>a Field of values of the solution on the mesh points of the grid;</li>
<li>a PolarSplineMem representation of the solution.</li>
</ul>
<p>The AdvectionFieldFinder can handle as input the two forms.
If a Field is given as input, it computes the spline representation (on the cross-product of two 1D bases) using a SplineBuilder2D.
The spline representation is needed to compute the derivatives of the function <span class="arithmatex">\(\phi\)</span>.
If the PolarSplineMem representation is given as input, it can directly compute the derivatives of the function <span class="arithmatex">\(\phi\)</span>.</p>
<p>Once the advection field computed, it is given as input to the BslAdvectionRTheta operator to advect the density <span class="arithmatex">\(\rho\)</span> function.
The BslAdvectionRTheta operator can handle the advection with an advection field along <span class="arithmatex">\((x,y)\)</span> and with an advection field along <span class="arithmatex">\((r,\theta)\)</span>.
But as the BslAdvectionRTheta operator advects in the physical domain, it is recommended to work with the advection field along <span class="arithmatex">\((x,y)\)</span>.</p>
<h3 id="advection-field-along-the-physical-domain-axis">Advection field along the physical domain axis</h3>
<p>Thanks to the spline representation, the derivatives <span class="arithmatex">\(\partial_r \phi\)</span> and <span class="arithmatex">\(\partial_\theta \phi\)</span> are computed.
The computation of the electrical field can be ill-defined around the O-point, so we treat this area separately.</p>
<ul>
<li>If <span class="arithmatex">\(r &gt; \varepsilon\)</span>, we use</li>
</ul>
<div class="arithmatex">\[
\nabla \phi
= \partial_x \phi e_x + \partial_y \phi e_y
= J^{-T}(\partial_r \phi e^r + \partial_\theta \phi e^\theta),
\qquad
\text{in the covariant basis,}
\]</div>
<p>with <span class="arithmatex">\(J\)</span>  the Jacobian matrix  of the coordinate transformation (mapping) <span class="arithmatex">\(\mathcal{F}: (r,\theta)\mapsto(x,y)\)</span> and <em>G</em> the tensor metric of the contravariant basis of the curvilinear coordinates <span class="arithmatex">\((r,\theta)\)</span>.
Then the electric field is given by</p>
<div class="arithmatex">\[
E = -\nabla \phi
= - \partial_x \phi e_x - \partial_y \phi e_y
\]</div>
<p>and the advection field in the basis <span class="arithmatex">\((e_x, e_y)\)</span> by</p>
<div class="arithmatex">\[
A = E\wedge e_z
=
\begin{bmatrix}
     E\cdot e_y  \\
    -E\cdot e_x
\end{bmatrix}
=
\begin{bmatrix}
    -\partial_y \phi \\
     \partial_x \phi
\end{bmatrix}.
\]</div>
<ul>
<li>If <span class="arithmatex">\(r \leq \varepsilon\)</span>, we linearise. The method is detailed in Zoni et al. (2019) <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>. We use only the derivatives along <span class="arithmatex">\(r\)</span> at two linearly independent directions of <span class="arithmatex">\(\theta\)</span> : <span class="arithmatex">\(\theta_1\)</span> and <span class="arithmatex">\(\theta_2\)</span></li>
</ul>
<div class="arithmatex">\[
\partial_r \phi (0, \theta_1) = \left[\partial_r x  \partial_x \phi + \partial_r y  \partial_y \phi \right] (0, \theta_1), \\
\partial_r \phi (0, \theta_2) = \left[\partial_r x  \partial_x \phi + \partial_r y  \partial_y \phi \right] (0, \theta_2).
\]</div>
<p>From these equations, we deduce the (unique) values of <span class="arithmatex">\(\partial_x\phi\)</span> and <span class="arithmatex">\(\partial_y\phi\)</span> at <span class="arithmatex">\((x,y) = (0,0)\)</span>,</p>
<div class="arithmatex">\[
\begin{bmatrix}
    \partial_x \phi (0, \theta) \\
    \partial_y \phi (0, \theta)
\end{bmatrix}
 =
 \begin{bmatrix}
    \partial_r x (0, \theta_1)  &amp; \partial_r y (0, \theta_1) \\
    \partial_r x (0, \theta_2)  &amp; \partial_r y (0, \theta_2)
\end{bmatrix} ^{-1}
\begin{bmatrix}
    \partial_r \phi (0, \theta_1) \\
    \partial_r \phi (0, \theta_2)
\end{bmatrix}.
\]</div>
<p>Then we compute <span class="arithmatex">\(E\)</span> at <span class="arithmatex">\((x,y) = (0,0)\)</span> and <span class="arithmatex">\((x,y) = \mathcal{F}(\varepsilon,\theta)\)</span> <span class="arithmatex">\(\forall \theta\)</span> (for <span class="arithmatex">\(\varepsilon\neq 0\)</span>, we use the Jacobian matrix as previously) and we linearise</p>
<div class="arithmatex">\[
E(r, \theta) = \left( 1 - \frac{r}{\varepsilon} \right)  E(0, \theta) + \frac{r}{\varepsilon} E(\varepsilon, \theta), \\
\]</div>
<p>As previously, we compute the advection field by</p>
<div class="arithmatex">\[
A = E\wedge e_z
=
\begin{bmatrix}
      E\cdot e_y  \\
    - E\cdot e_x
\end{bmatrix}.
\]</div>
<p>(In the code, we chose <span class="arithmatex">\(\theta_1 = \frac{\pi}{4}\)</span> and <span class="arithmatex">\(\theta_2  = - \frac{\pi}{4}\)</span>, and <span class="arithmatex">\(\varepsilon = 10^{-12}\)</span>.)</p>
<h3 id="advection-field-along-the-logical-domain-axis">Advection field along the logical domain axis</h3>
<p>Firstly, the derivatives <span class="arithmatex">\(\partial_r \phi\)</span> and <span class="arithmatex">\(\partial_\theta \phi\)</span> are also computed here.</p>
<h4 id="general-coordinates-system">General coordinates system</h4>
<ul>
<li>In a <strong>general coordinate system</strong>, the gradient of a scalar function in the logical domain is given in the <a href="../../../docs/standards/mathematical_and_physical_conventions.html">covariant basis</a> by</li>
</ul>
<div class="arithmatex">\[
\nabla f = \sum_i \partial_{q_i} f b^i
\]</div>
<p>with</p>
<ul>
<li><span class="arithmatex">\(J\)</span> the Jacobian matrix associated with the mapping function of the system <span class="arithmatex">\(\mathcal{F}:(q_1,..., q_N)\mapsto(x_1, ..., x_N)\)</span>,</li>
<li>and <span class="arithmatex">\(b^j\)</span> the unnormalised local covariant vectors.</li>
</ul>
<p>In 2D with <span class="arithmatex">\((q_1, q_2) = (r,\theta)\)</span> and <span class="arithmatex">\((x_1, x_2) = (x,y)\)</span>, it can be rewritten as the following matrix system</p>
<div class="arithmatex">\[
\hat{\nabla} f
= \partial_x f e_x + \partial_y f e_y
= \partial_r f e^r + \partial_\theta f e^\theta
\]</div>
<p>With the composants linked by the following relation,</p>
<div class="arithmatex">\[
\begin{bmatrix}
    \partial_{x} f \\
    \partial_{y} f
\end{bmatrix}
=
J^{-T}
\begin{bmatrix}
    \partial_{r} f \\
    \partial_{\theta} f
\end{bmatrix}.
\]</div>
<h4 id="application-to-the-advection-field">Application to the advection field</h4>
<p>The gradient is expressed in the <em>covariant</em> basis. We express the advection field in the <em>contravariant</em> basis to use the nice property <span class="arithmatex">\(e_r\cdot e^r = 1\)</span> and <span class="arithmatex">\(e_\theta\cdot e^\theta = 1\)</span>.</p>
<ul>
<li>In the <a href="../../../docs/standards/mathematical_and_physical_conventions.html">contravariant basis</a> <span class="arithmatex">\((e_r, e_\theta)\)</span>,
we compute the electric field,</li>
</ul>
<div class="arithmatex">\[
E
=
\begin{bmatrix}
    E \cdot e_r \\
    E \cdot e_{\theta}
\end{bmatrix}
=
G^{-1}
\begin{bmatrix}
    - \partial_{r} \phi \\
    - \partial_{\theta} \phi
\end{bmatrix}.
\]</div>
<p>with <span class="arithmatex">\(G^{-1}\)</span> the inverse <a href="../../../docs/standards/mathematical_and_physical_conventions.html">metric tensor</a>.</p>
<p>Then the advection field is given by</p>
<div class="arithmatex">\[
A = E \wedge e_z =
\begin{bmatrix}
     E \cdot e_y \\
    -E \cdot e_x
\end{bmatrix},
\]</div>
<p>with in contravariant basis,</p>
<div class="arithmatex">\[
\begin{bmatrix}
    E \cdot e_x \\
    E \cdot e_y
\end{bmatrix}
=
J
\begin{bmatrix}
    E \cdot e_r \\
    E \cdot e_\theta
\end{bmatrix} ,
\qquad
\begin{bmatrix}
    A \cdot e_x \\
    A \cdot e_y
\end{bmatrix}
=
J
\begin{bmatrix}
    A \cdot e_r \\
    A \cdot e_\theta
\end{bmatrix}.
\]</div>
<p>So,</p>
<div class="arithmatex">\[
\begin{bmatrix}
    A \cdot e_r \\
    A \cdot e_\theta
\end{bmatrix}
= J^{-1}
\begin{bmatrix}
    A \cdot e_x \\
    A \cdot e_y
\end{bmatrix}
= J^{-1}
\begin{bmatrix}
     E \cdot e_y \\
    -E \cdot e_x
\end{bmatrix}
= J^{-1}
\begin{bmatrix}
    J_{2,1} &amp; J_{2,2} \\
    -J_{1,1} &amp; -J_{1,2}
\end{bmatrix}
\begin{bmatrix}
    E \cdot e_r \\
    E \cdot e_\theta
\end{bmatrix}
= \frac{1}{\det(J)}
\begin{bmatrix}
    (J_{11}J_{12} + J_{21}J_{22})  &amp;  (J_{22}^2 + J_{12}^2) \\
    -(J_{11}^2 + J_{21}^2)         &amp; -(J_{11}J_{12} + J_{21}J_{22})
\end{bmatrix}
\begin{bmatrix}
    E \cdot e_r \\
    E \cdot e_\theta
\end{bmatrix}
\]</div>
<p>with <span class="arithmatex">\(J_{ij}\)</span> the elements of the matrix <em>J</em>.</p>
<p>Warning, the matrix <span class="arithmatex">\(G^{-1}\)</span> can be ill-defined for <span class="arithmatex">\(r = 0\)</span>.</p>
<p><em>Example: circular mapping:</em></p>
<div class="arithmatex">\[
G^{-1}
=
\begin{bmatrix}
    1 &amp; 0 \\
    0 &amp; \frac{1}{r^2}
\end{bmatrix}.
\]</div>
<p>In the code, the O-point is differently treated. The domain is split between a domain without the O-point (<span class="arithmatex">\((0,\theta), \forall \theta\)</span>) and the domain containing only the O-point. For the first domain, we compute the advection field along the logical axis as explain previously. On the second domain, we compute the unique value of the advection field along the physical axis using the linearisation done in the <a href="#guiding-centre-case">Advection field along the physical domain axis</a> section.</p>
<h2 id="contents">Contents</h2>
<ul>
<li>advection_field_rtheta.hpp : containing AdvectionFieldFinder with the advection field computation for the guiding centre simulation.</li>
</ul>
<h2 id="references">References</h2>
<div class="footnote">
<hr>
<ol>
<li id="fn:1">
<p>Edoardo Zoni, Yaman Güçlü, "Solving hyperbolic-elliptic problems on singular mapped disk-like domains with the
method of characteristics and spline finite elements", <a href="https://doi.org/10.1016/j.jcp.2019.108889">https://doi.org/10.1016/j.jcp.2019.108889</a>, Journal of Computational Physics, 2019. <a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../advection/index.html" class="btn btn-neutral float-left" title="Advection operator"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../geometry/index.html" class="btn btn-neutral float-right" title="Geometry RTheta">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/gyselax/gyselalibxx/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../advection/index.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../geometry/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../docs/jscript/mathjax.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
