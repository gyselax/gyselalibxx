<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gyselalib++: Coding Standards</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Gyselalib++
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('docs_CODING_STANDARD.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Coding Standards</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="docs_CODING_STANDARD__Cxx_Features"></a>
C++ Features</h1>
<ul>
<li>We use C++17</li>
<li>We don't use raw pointers</li>
<li>We don't use plain C arrays</li>
<li>We try not to use macros</li>
<li>The <code>auto</code> keyword should be used for types as <code>auto&amp;&amp;</code> and only in one of the following cases:<ul>
<li>in iterations either in range based for or to refer to iterators</li>
<li>to store objects that can not be typed otherwise (e.g. lambdas)</li>
<li>to store the result of an expression specifically specifying the type of the generated value</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="docs_CODING_STANDARD__Parameter_passing"></a>
Parameter passing</h1>
<ul>
<li>We take out/inout-parameters (those we modify) first</li>
<li>If there is a single out/inout-parameter, we return it</li>
<li>For in-parameters (those we use but don't modify)<ul>
<li>if it's a scalar native type (int, double, ...) we take it by copy</li>
<li>if it's a const view type (<code>std::span&lt;const <a class="el" href="structT.html" title="A class which describes the real space in the temporal direction.">T</a>&gt;</code>, <code>BlockView&lt;<a class="el" href="structT.html" title="A class which describes the real space in the temporal direction.">T</a>&gt;</code>, ...) we take it by copy</li>
<li>otherwise, we take a const-ref: <code>Type const&amp;</code></li>
</ul>
</li>
<li>For out/inout-parameters<ul>
<li>if it's a modifiable view type (<code>std::span&lt;<a class="el" href="structT.html" title="A class which describes the real space in the temporal direction.">T</a>&gt;</code>, <code>BlockSpan&lt;<a class="el" href="structT.html" title="A class which describes the real space in the temporal direction.">T</a>&gt;</code>, ...) we take it by copy</li>
<li>otherwise, we take a ref: <code>Type&amp;</code></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="docs_CODING_STANDARD__Naming"></a>
Naming</h1>
<ul>
<li>we name everything using expressive English names (e.g. <code>temperature</code>) and don't use variable names from the equations (e.g. <code>u</code>, <code>u_bar_star</code>)</li>
<li>files, functions and variables use <code>snake_case</code></li>
<li>types use <code>CamelCase</code></li>
<li>macros use <code>ALL_CAPS</code></li>
<li>non-static member variables names begin with an <code>m_</code> prefix</li>
<li>static member variables names begin with an <code>s_</code> prefix</li>
<li>we don't use single letter variables</li>
<li>we don't rely on case to distinguish between variables</li>
<li>there are two types of DDC objects representing a multidimensional array : <code>ddc::Chunk</code> (which possesses the data) and <code>ddc::ChunkSpan</code> (which does not own the data but can be captured by <code>KOKKOS_LAMBDA</code>). We suffix <code>Chunk</code> with <code>_alloc</code> if both variables are needed locally.</li>
<li>if a variable is mirrored between host (CPU) and device (GPU) memories, the variable representing data on host is <code>_host</code> suffixed</li>
<li>capturing classes members through <code>KOKKOS_LAMBDA</code> or <code>KOKKOS_CLASS_LAMBDA</code> may be complicated, we often need to copy-by-reference the member to a local variable, which must be <code>_proxy</code> suffixed</li>
</ul>
<h1><a class="anchor" id="docs_CODING_STANDARD__Style"></a>
Style</h1>
<ul>
<li>We use the style specified by the <code>.clang-format</code> file using clang-format 10</li>
<li>we do not use numerical values in the code except to initialise a named constexpr documenting the semantic of the value</li>
<li>In a class<ul>
<li>we put all member types first (public, then protected, then private),</li>
<li>followed by static member variables (public, then protected, then private),</li>
<li>followed by non-static member variables (public, then protected, then private),</li>
<li>followed by static member functions (public, then protected, then private),</li>
<li>followed by non-static member functions (public, then protected, then private),<ul>
<li>the constructors first</li>
<li>then the destructor</li>
<li>then the various operators</li>
<li>then the accessors</li>
<li>then the more complex functions</li>
</ul>
</li>
</ul>
</li>
<li>We comment our code with Doxygen</li>
<li>We use at @keywords in Doxygen</li>
<li>we use east-const: <code>int const</code> rather than <code>const int</code></li>
</ul>
<h1><a class="anchor" id="docs_CODING_STANDARD__Operators"></a>
Operators</h1>
<h3><a class="anchor" id="autotoc_md6"></a>
Interfaces</h3>
<p>We define an <em>interface</em> to be an empty class (i.e. without any member variable) offering a pure virtual call operator: <code>operator()</code> and can offer various overloads of this operator with different parameters but similar behaviour.</p>
<p>Interfaces should:</p>
<ul>
<li>be prefixed by <code>I</code> as in <code><a class="el" href="classIVlasovSolver.html" title="An abstract class for solving a Vlasov equation.">IVlasovSolver</a></code>,</li>
<li>explicitly define a virtual destructor,</li>
<li>implicitly define constructors and assignment operators.</li>
</ul>
<h3><a class="anchor" id="autotoc_md7"></a>
Implementation</h3>
<p>Implementation classes should implement at least one interface. When relying on other operations, these classes should use the dependency injection pattern. Each implementation class should take <code>const</code> references to the used operations interfaces as parameters of the constructor and store them so as to call them in the <code>operator()</code> implementation.</p>
<h1><a class="anchor" id="docs_CODING_STANDARD__Code_Organisation"></a>
Code Organisation</h1>
<h3><a class="anchor" id="autotoc_md8"></a>
Object-Oriented vs. Functional Programming</h3>
<p>There are multiple coding paradigms possible when writing code in C++. Two of the most common are object-oriented programming and functional programming. In object-oriented programming the aim is to make code more readable by grouping concepts within a class. Therefore functions are saved with the data on which they operate. On the other hand, in functional programming the aim is to make code more readable by making it more obvious where data is modified. This is done by separating data storage from operators. This way, data can never be modified inside its class without passing through an operator. In our code the functional programming paradigm was chosen as it allows us to write the code in a way which more closely resembles the equations.</p>
<p>The code is therefore generally split into two types of classes: Operators and Data Storage. In order to ensure that you are following the functional programming paradigm when writing your code you should try to respect this separation.</p>
<h4><a class="anchor" id="autotoc_md9"></a>
Operators</h4>
<p>An operator is an object which can be described by an equation. For example a Poisson solver, an advection operator or a spline interpolation.</p>
<p>Classes describing operators should contain as little data as possible. Data should only be stored in the operator if it is not relevant anywhere else in the code. If removing this operator to replace it with a new method would result in this data also being removed then it may be relevant to store it in the class.</p>
<p>All operators should implement the function <code>operator()</code>. Usually this is the only function in the operator other than the constructor.</p>
<p>If the operator relies on other operators (e.g. a semi-Lagrangian advection which requires an interpolation operator) then this dependency should be passed to the operator's constructor. It should be stored as a reference inside the function.</p>
<h4><a class="anchor" id="autotoc_md10"></a>
Data Storage</h4>
<p>It is rare to need to actually write a data storage class. In most cases they can be defined with a "using-declaration" using DDC types. This ensures that the data is defined on the relevant dimensions which in turn reduces the chance of errors arising from operating on the wrong dimensions of an array. For more information see <a href="https://github.com/Maison-de-la-Simulation/ddchttps://github.com/Maison-de-la-Simulation/ddc">DDC</a>.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
Template Strategy</h3>
<p>Templating is a very useful tool to improve performance, however it increases compilation overhead and reduces code readability, especially for developers less familiar with C++. We therefore try to strike a balance with the use of templates. Templates are therefore recommended in the following cases:</p>
<ul>
<li>In performance bottlenecks to improve results.</li>
<li>Where they significantly decrease code duplication (~2 additional copies avoided). </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
