<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gyselalib++: Advection Field finder</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Gyselalib++
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('src_geometryRTheta_advection_field.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Advection Field finder </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The operator implemented here is a previous step to the advection operator. It computes the advection field along the axes in the physical domain or the axes in the logical domain.</p>
<p>Currently, the implemented case is:</p><ul>
<li>Guiding center equations system.</li>
</ul>
<h1><a class="anchor" id="src_geometryRTheta_advection_field__Guiding_center_case"></a>
Guiding center case</h1>
<p>The studied equation system is of the following type : </p><p class="formulaDsp">
\[\partial_t \rho + A\cdot\nabla \rho = 0, \\ A = E \wedge e_z, \\ E = - \nabla \phi, \\ - \nabla \cdot \nabla \phi = \rho, \]
</p>
<p> with \(\rho\) the density, \(\phi\) the electrostatic potential and \(E\) the electrical field.</p>
<p>The <a class="el" href="classAdvectionFieldFinder.html" title="Solve the Poisson-like equation and return the electric field for the coupled Vlasov equation.">AdvectionFieldFinder</a> computes the advection field \(A\) from the electrical field \(\phi\) returned by the <a class="el" href="classPolarSplineFEMPoissonLikeSolver.html" title="Define a polar PDE solver for a Poisson-like equation.">PolarSplineFEMPoissonLikeSolver</a>. It has two types of <code>operator()</code>:</p><ul>
<li>one returning the advection field along the axis of the physical domain: \(A = (A_x, A_y)\)</li>
<li>and the another returning the advection field along the axis of the logical domain: \(A = (A_r, A_\theta)\).</li>
</ul>
<p>The <a class="el" href="classPolarSplineFEMPoissonLikeSolver.html" title="Define a polar PDE solver for a Poisson-like equation.">PolarSplineFEMPoissonLikeSolver</a> can return the solution \(\phi\) of the PDE under two forms:</p><ul>
<li>a Chunk of values of the solution on the mesh points of the grid;</li>
<li>a <a class="el" href="structPolarSpline.html" title="A structure containing the two Chunks necessary to define a spline on a set of polar basis splines.">PolarSpline</a> representation of the solution.</li>
</ul>
<p>The <a class="el" href="classAdvectionFieldFinder.html" title="Solve the Poisson-like equation and return the electric field for the coupled Vlasov equation.">AdvectionFieldFinder</a> can handle as input the two forms. If a Chunk is given as input, it computes the spline representation (on the cross-product of two 1D bases) using a SplineBuilder2D. The spline representation is needed to compute the derivatives of the function \(\phi\). If the <a class="el" href="structPolarSpline.html" title="A structure containing the two Chunks necessary to define a spline on a set of polar basis splines.">PolarSpline</a> representation is given as input, it can directly compute the derivatives of the function \(\phi\).</p>
<p>Once the advection field computed, it is given as input to the <a class="el" href="classBslAdvectionRP.html" title="Define an advection operator on 2D  domain.">BslAdvectionRP</a> operator to advect the density \(\rho\) function. The <a class="el" href="classBslAdvectionRP.html" title="Define an advection operator on 2D  domain.">BslAdvectionRP</a> operator can handle the advection with an advection field along \((x,y)\) and with an advection field along \((r,\theta)\). But as the <a class="el" href="classBslAdvectionRP.html" title="Define an advection operator on 2D  domain.">BslAdvectionRP</a> operator advects in the physical domain, it is recommend to work with the advection field along \((x,y)\).</p>
<h3><a class="anchor" id="autotoc_md44"></a>
Advection field along the physical domain axis</h3>
<p>Thanks to the spline representation, the derivatives \(\partial_r \phi\) and \(\partial_\theta \phi\) are computed. The computation of the electrical field can be ill-defined around the O-point so we treat this area separately.</p>
<ul>
<li>If \(r &gt; \varepsilon\), we use <p class="formulaDsp">
\[\begin{bmatrix} \partial_x \phi \\ \partial_y \phi \\ \end{bmatrix} = J^{-T} \begin{bmatrix} \partial_r \phi \\ \partial_\theta \phi \\ \end{bmatrix} \]
</p>
 with \(J\) the Jacobian matrix of the mapping \(\mathcal{F}: (r,\theta)\mapsto(x,y)\). Then the electric field is given by <p class="formulaDsp">
\[E = -\nabla \phi = \begin{bmatrix} - \partial_x \phi \\ - \partial_y \phi \\ \end{bmatrix} \]
</p>
 and the advection field by <p class="formulaDsp">
\[A = E\wedge e_z = \begin{bmatrix} - E_y \\ E_x \\ \end{bmatrix} = \begin{bmatrix} \partial_y \phi \\ - \partial_x \phi \\ \end{bmatrix}. \]
</p>
</li>
<li><p class="startli">If \(r \leq \varepsilon\), we linearise. The method is detailed in Edoardo Zoni's article [1]. We use only the derivatives along \(r\) at two linearly independent directions of \(\theta\) : \(\theta_1\) and \(\theta_2\) </p><p class="formulaDsp">
\[\partial_r \phi (0, \theta_1) = \left[\partial_r x \partial_x \phi + \partial_r y \partial_y \phi \right] (0, \theta_1), \\ \partial_r \phi (0, \theta_2) = \left[\partial_r x \partial_x \phi + \partial_r y \partial_y \phi \right] (0, \theta_2). \]
</p>
<p> From these equations, we deduce the (unique) values of \(\partial_x\phi\) and \(\partial_y\phi\) at \((x,y) = (0,0)\),</p>
<p class="formulaDsp">
\[\begin{bmatrix} \partial_x \phi (0, \theta) \\ \partial_y \phi (0, \theta) \\ \end{bmatrix} = \begin{bmatrix} \partial_r x (0, \theta_1) &amp; \partial_r y (0, \theta_1) \\ \partial_r x (0, \theta_2) &amp; \partial_r y (0, \theta_2) \\ \end{bmatrix} ^{-1} \begin{bmatrix} \partial_r \phi (0, \theta_1) \\ \partial_r \phi (0, \theta_2) \\ \end{bmatrix}. \]
</p>
<p> Then we compute \(E\) at \((x,y) = (0,0)\) and \((x,y) = \mathcal{F}(\varepsilon,\theta)\) \(\forall \theta\) (for \(\varepsilon\neq 0\), we use the Jacobian matrix as previously) and we linearise</p>
<p class="formulaDsp">
\[E_x(r, \theta) = \left( 1 - \frac{r}{\varepsilon} \right) E_x(0, \theta) + \frac{r}{\varepsilon} E_x(\varepsilon, \theta), \\ E_y(r, \theta) = \left( 1 - \frac{r}{\varepsilon} \right) E_y(0, \theta) + \frac{r}{\varepsilon} E_y(\varepsilon, \theta), \]
</p>
<p> As previously, we compute the advection field by </p><p class="formulaDsp">
\[A = E\wedge e_z = \begin{bmatrix} - E_y \\ E_x \\ \end{bmatrix} = \begin{bmatrix} \partial_y \phi \\ - \partial_x \phi \\ \end{bmatrix}. \]
</p>
<p> (In the code, we chose \(\theta_1 = \frac{\pi}{4}\) and \(\theta_2 = - \frac{\pi}{4}\), and \(\varepsilon = 10^{-12}\).)</p>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md45"></a>
Advection field along the logical domain axis</h3>
<p>Firstly, the derivatives \(\partial_r \phi\) and \(\partial_\theta \phi\) are also computed here.</p>
<h4><a class="anchor" id="autotoc_md46"></a>
General coordinates system</h4>
<ul>
<li><p class="startli">In <b>general coordinates system</b>, the gradiant of a function is given by</p>
<p class="formulaDsp">
\[\nabla f = \sum_i \sum_j \partial_{x_i} f g^{ij} \sqrt{g_{jj}} \hat{e}_j, \]
</p>
<p> with</p>
</li>
<li>\(J\) the Jacobian matrix associated the the mapping function of the system \(\mathcal{F}:(x_1, x_2)\mapsto(y_1,y_2)\),</li>
<li>\(G = J^T J = [g_{ij}]_{ij}\) the metric tensor,</li>
<li>\(G^{-1} = [g^{ij}]_{ij}\) the inverse metric tensor</li>
<li>and \(\hat{e}_j\) the normalized covariant vectors.</li>
</ul>
<p>In 2D, it can be rewritten as the following matrix system </p><p class="formulaDsp">
\[\nabla f = D_{G} G^{-T} \begin{bmatrix} \partial_{x_1} f \\ \partial_{x_2} f \\ \end{bmatrix} = \begin{bmatrix} \sqrt{g_{11}} &amp; 0 \\ 0 &amp; \sqrt{g_{22}} \\ \end{bmatrix} \begin{bmatrix} g^{11} &amp; g^{21} \\ g^{12} &amp; g^{22} \\ \end{bmatrix} \begin{bmatrix} \partial_{x_1} f \\ \partial_{x_2} f \\ \end{bmatrix}. \]
</p>
<p> <b>Remark:</b> We can prove that \(\det(D_{G} G^{-T}) = 0\) if \(\det(J) = 0\) (if the coefficients of the matrix \(D_G\) are not null). So for an invertible matrix, we also have the relation </p><p class="formulaDsp">
\[\begin{bmatrix} \partial_{x_1} f \\ \partial_{x_2} f \\ \end{bmatrix} = G^{T}D_{G}^{-1} \nabla f. \]
</p>
<p> From the relation </p><p class="formulaDsp">
\[\begin{bmatrix} \partial_{y_1} f \\ \partial_{y_2} f \\ \end{bmatrix} = J^{-T} \begin{bmatrix} \partial_{x_1} f \\ \partial_{x_2} f \\ \end{bmatrix}, \]
</p>
<p> we deduce the following relation for invertible case </p><p class="formulaDsp">
\[\nabla_{y_1, y_2} f = J D_{G}^{-1} \nabla_{x_1, x_2} f, \]
</p>
<p> with \(\nabla_{y_1, y_2} f = [\partial_{y_1} f, \partial_{y_2} f]^T\) and \(\nabla_{x_1, x_2} f = \sum_i \sum_j \partial_{x_i} f g^{ij} \sqrt{g_{jj}} \hat{e}_j\).</p>
<h4><a class="anchor" id="autotoc_md47"></a>
Aplication to the advection field</h4>
<ul>
<li>In our case, we use this formula to compute the electric field along the logical axis: <p class="formulaDsp">
\[E = -\nabla \phi = - D_{G} (G^{-1})^{T} \begin{bmatrix} \partial_{r} \phi \\ \partial_{\theta} \phi \\ \end{bmatrix}. \]
</p>
 Then the advection field is given by <p class="formulaDsp">
\[A = E \wedge e_z = \begin{bmatrix} -E_{\theta} \\ E_r \\ \end{bmatrix}. \]
</p>
 Warning, the matrix \((G^{-1})^{T}\) is ill-defined for \(r = 0\).</li>
</ul>
<p><em>Example: circular mapping:</em> </p><p class="formulaDsp">
\[(G^{-1})^{T} = \begin{bmatrix} 1 &amp; 0 \\ 0 &amp; \frac{1}{r^2} \\ \end{bmatrix}. \]
</p>
<p> In the code, the O-point is differently treated. The domain is splitted between a domain without the O-point ( \((0,\theta), \forall \theta\)) and the domain containing only the O-point. For the first domain, we compute the advection field along the logical axis as explain previously. On the second domain, we compute the unique value of the advection field along the physical axis using the linearisation done in the <em>Advection field along the physical domain axis</em> section.</p>
<h1><a class="anchor" id="autotoc_md48"></a>
References</h1>
<p>[1] Edoardo Zoni, Yaman Güçlü, "Solving hyperbolic-elliptic problems on singular mapped disk-like domains with the 
method of characteristics and spline finite elements", <a href="https://doi.org/10.1016/j.jcp.2019.108889">https://doi.org/10.1016/j.jcp.2019.108889</a>, Journal of Computational Physics, 2019.</p>
<h1><a class="anchor" id="autotoc_md49"></a>
Contents</h1>
<ul>
<li><a class="el" href="advection__field__rp_8hpp_source.html">advection_field_rp.hpp</a> : containing <a class="el" href="classAdvectionFieldFinder.html" title="Solve the Poisson-like equation and return the electric field for the coupled Vlasov equation.">AdvectionFieldFinder</a> with the advection field computation for the guiding center simulation. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
