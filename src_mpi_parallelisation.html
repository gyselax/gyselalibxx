<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gyselalib++: Parallelisation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Gyselalib++
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('src_mpi_parallelisation.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Parallelisation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This folder contains all code related to the MPI parallelisation. The parallelisation is mainly managed by two concepts:</p><ul>
<li>Layout</li>
<li>TransposeOperator</li>
</ul>
<p>This folder contains the implementation of the superclasses for these two concepts as well as some specific implementations for these concepts. There are also some tools which are useful for the implementation of these concepts.</p>
<h1><a class="anchor" id="src_mpi_parallelisation__Layout"></a>
Layout</h1>
<p>The layouts describe how the data should be laid out in memory across different MPI processes. It indicates the normal ordering of dimensions in the domain associated with the layout and which of those dimensions may contains data distributed across multiple MPI processes. These classes implement an operator which allows the local domain to be obtained from a global domain and specifications about the MPI configuration (number of ranks and current rank).</p>
<h1><a class="anchor" id="src_mpi_parallelisation__TransposeOperator"></a>
TransposeOperator</h1>
<p>The transpose operators are the operators which are used to move from one layout to another. They send and receive data between MPI processes.</p>
<h1><a class="anchor" id="src_mpi_parallelisation__Alltoall_Transpose_Operator"></a>
Alltoall Transpose Operator</h1>
<p>The alltoall transpose operator is based on the transpose operator present in the Fortran version of Gysela. It uses MPI's Alltoall operator to move from a layout distributed over a given set of dimensions to another layout distributed over an orthogonal set of dimensions. This is achieved by reordering the data such that the data blocks to be sent to each MPI rank are contiguous. Finally after the Alltoall call the data is reordered back into the expected final layout.</p>
<h3><a class="anchor" id="autotoc_md63"></a>
Example</h3>
<p>Let us consider the 5D domain (Sp, <a class="el" href="structR.html" title="Define non periodic real R dimension.">R</a>, <a class="el" href="structTheta.html" title="Define periodic real Theta dimension.">Theta</a>, <a class="el" href="structVpar.html" title="Define non periodic parallel velocity .">Vpar</a>, <a class="el" href="structMu.html" title="Define non periodic magnetic momentum .">Mu</a>) with the following number of points in each dimension : \((n_{sp} = 2, n_r = 4, n_\theta = 16, n_{vpar} = 8, n_\mu = 4)\).</p>
<p>Suppose that we distribute this data in two different ways:</p><ol type="1">
<li><b>PoloidalLayout</b> - Distributed in \((Vpar, Mu)\).</li>
<li><b>CollisionalLayout</b> - Distributed in \((R, Theta)\).</li>
</ol>
<p>If we have 16 MPI ranks then each rank has a domain with the following number of points in each dimension for each layout:</p><ol type="1">
<li><b>PoloidalLayout</b> - \((n_{sp} = 2, n_{vpar} = 1, n_\mu = 2, n_r = 4, n_\theta = 16)\)</li>
<li><b>CollisionalLayout</b> - \((n_{sp} = 2, n_r = 1, n_\theta = 4, n_{vpar} = 8, n_\mu = 4)\)</li>
</ol>
<p>Suppose that the alltoall transpose operator is called with an input type of <code>DField&lt;IdxRange&lt;<a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>&gt;&gt;</code> on the poloidal layout and an output type of <code>DField&lt;IdxRange&lt;<a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>&gt;&gt;</code> on the collisional layout. The steps carried out by the alltoall transpose operator are:</p>
<ol type="1">
<li>Break the field to introduce the splits along which the field will be split. This operation does not require any copying.<ul>
<li>Before:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>&gt;&gt;</code></li>
<li><b>size</b>: (2, 1, 2, 4, 16)</li>
</ul>
</li>
<li>After:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridR.html">GridR</a>&gt;, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridTheta.html">GridTheta</a>&gt;, <a class="el" href="structGridTheta.html">GridTheta</a>&gt;&gt;</code></li>
<li><b>size</b>: (2, 1, 2, 4, 1, 4, 4)</li>
</ul>
</li>
</ul>
</li>
<li>Reorder the dimensions so the MPI dimensions are grouped in the first dimensions of the domain:<ul>
<li>Before:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridR.html">GridR</a>&gt;, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridTheta.html">GridTheta</a>&gt;, <a class="el" href="structGridTheta.html">GridTheta</a>&gt;&gt;</code></li>
<li><b>size</b>: (2, 1, 2, 4, 1, 4, 4)</li>
</ul>
</li>
<li>After:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridR.html">GridR</a>&gt;, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridTheta.html">GridTheta</a>&gt;, <a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>&gt;&gt;</code></li>
<li><b>size</b>: (4, 4, 2, 1, 2, 1, 4)</li>
</ul>
</li>
</ul>
</li>
<li>Call AlltoAll to send the subblocks <code>field[mpi_idx_r, mpi_idx_theta]</code> to each MPI rank. The data received from each rank will allow the <a class="el" href="structVpar.html" title="Define non periodic parallel velocity .">Vpar</a> and <a class="el" href="structMu.html" title="Define non periodic magnetic momentum .">Mu</a> dimensions to be reassembled.<ul>
<li>Before:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridR.html">GridR</a>&gt;, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridTheta.html">GridTheta</a>&gt;, <a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>&gt;&gt;</code></li>
<li><b>size</b>: (4, 4, 2, 1, 2, 1, 4)</li>
</ul>
</li>
<li>After:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridVpar.html">GridVpar</a>&gt;, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridMu.html">GridMu</a>&gt;, <a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>&gt;&gt;</code></li>
<li><b>size</b>: (4, 4, 2, 1, 2, 1, 4)</li>
</ul>
</li>
</ul>
</li>
<li>Reorder the dimensions so data relative to the <a class="el" href="structVpar.html" title="Define non periodic parallel velocity .">Vpar</a> and <a class="el" href="structMu.html" title="Define non periodic magnetic momentum .">Mu</a> dimensions are placed contiguously and dimensions are ordered as expected in the output layout:<ul>
<li>Before:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridVpar.html">GridVpar</a>&gt;, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridMu.html">GridMu</a>&gt;, <a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>&gt;&gt;</code></li>
<li><b>size</b>: (4, 4, 2, 1, 2, 1, 4)</li>
</ul>
</li>
<li>After:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridVpar.html">GridVpar</a>&gt;, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridMu.html">GridMu</a>&gt;, <a class="el" href="structGridMu.html">GridMu</a>&gt;&gt;</code></li>
<li><b>size</b>: (2, 1, 4, 4, 2, 4, 1)</li>
</ul>
</li>
</ul>
</li>
<li>Remove the metadata describing the MPI splits. This operation does not require any copying.<ul>
<li>Before:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridVpar.html">GridVpar</a>&gt;, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structMPIDim.html" title="An internal tag used to dsecribe an artificial dimension describing the MPI rank where the scattered ...">MPIDim</a>&lt;<a class="el" href="structGridMu.html">GridMu</a>&gt;, <a class="el" href="structGridMu.html">GridMu</a>&gt;&gt;</code></li>
<li><b>size</b>: (2, 1, 4, 4, 2, 4, 1)</li>
</ul>
</li>
<li>After:<ul>
<li><b>type</b>: <code>DField&lt;IdxRange&lt;<a class="el" href="structSpecies.html">Species</a>, <a class="el" href="structGridR.html">GridR</a>, <a class="el" href="structGridTheta.html">GridTheta</a>, <a class="el" href="structGridVpar.html">GridVpar</a>, <a class="el" href="structGridMu.html">GridMu</a>&gt;&gt;</code></li>
<li><b>size</b>: (2, 1, 4, 8, 4) </li>
</ul>
</li>
</ul>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
