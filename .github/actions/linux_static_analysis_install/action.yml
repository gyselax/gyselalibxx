name: Install linux dependencies for static analyses

runs:
  using: "composite"
  steps:
    - name: Restore cached cppcheck
      id: cache-cppcheck-restore
      uses: actions/cache/restore@v4
      with:
        path: |
          /usr/local/share/Cppcheck/
          /usr/local/bin/cppcheck
        key: cppcheck-2-14-2
    - name: Install cppcheck
      if: steps.cache-cppcheck-restore.outputs.cache-hit != 'true'
      run: |
        git clone -b 2.14.2 https://github.com/danmar/cppcheck.git
        cd cppcheck
        cmake -DCMAKE_INSTALL_PREFIX=${GITHUB_WORKSPACE}/cppcheck_install -S . -B build
        cmake --build build
        cmake --install build
        cd ..
        ls
        ls ${GITHUB_WORKSPACE}/cppcheck_install
        rm -rf cppcheck
      shell: bash
    - name: Save cppcache
      id: cache-cppcheck-save
      if: steps.cache-cppcheck-restore.outputs.cache-hit != 'true'
      uses: actions/cache/save@v4
      with:
        path: |
          cppcheck_install/share/Cppcheck/
          cppcheck_install/bin/cppcheck
        key: ${{ steps.cache-cppcheck-restore.outputs.cache-primary-key }}
    - name: Update bath
      run: |
        echo "${GITHUB_WORKSPACE}/cppcheck_install/bin" >> ${GITHUB_PATH}
      shell: bash
