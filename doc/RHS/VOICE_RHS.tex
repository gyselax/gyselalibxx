%\documentclass[11pt,a4paper,twoside]{article}
\documentclass[11pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{amsmath, amssymb}
\usepackage{biblatex}
\usepackage{csquotes}
\usepackage{graphics}
\usepackage{epsfig}
\usepackage{changepage}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amscd}
\usepackage{hyperref}
\usepackage{cleveref}
\addbibresource{library.bib}


\textwidth 16cm
\textheight 23cm
\footskip 1.5cm
\headsep 0.5cm
\oddsidemargin 0.cm
\evensidemargin 0cm
\headheight -0cm
\topmargin 0cm

\newcommand{\HRule}[1]{\rule{0.5\linewidth}{#1}} 

\begin{document}

\begin{center}

    \LARGE \textbf{\uppercase{VOICE}}
    \vspace{0.8cm}  \\
    \normalsize \textsc{RHS operators} \\	% Subtitle
    \vspace{0.4cm} 
    \HRule{0.5pt} \\
    \vspace{0.7cm}
    \normalsize Y.~Munschy
    \vspace{0.2cm} \\
    \today
\end{center}


\section{Krook source and sink}
\label{sec:krook_source_and_sink}
The following operator is a BGK term \cite{BGK_Operator} that can act as a source or a sink of particles, momentum and energy. It has the following form:
\[  S_\mathrm{BGK}(x, v_a, t) = - \nu_\mathrm{a} \mathcal{M}\left( f_a - g \right)  \]
The $\nu_\mathrm{a}$ coefficient sets the magnitude of the operator. It can be either constant or space and time dependent, see below. The mask function $\mathcal{M}(x)$ defines the spatial extent of the simulation box where the operator is active. It is a hyperbolic tangent function that takes a value of one inside a specific domain, and vanishes outside. This mask can have two different forms. The first one is such that the mask equals one inside the domain  $\left[ x_\mathrm{\ell}, \, x_\mathrm{r} \right] $.  The Krook operator can then be used for instance as a source of particles active in this region. The mask function is thus defined in this case as
%
\begin{equation}\label{eq:mask_source}
     \mathcal{M}_{\mathrm{sc}}(x) = \dfrac{1}{2}\left\{ \operatorname{tanh}{\left(\dfrac{x-x_\mathrm{\ell}}{d}\right)} - \operatorname{tanh}{\left(\dfrac{x-x_\mathrm{r}}{d}\right)}  \right\} .
\end{equation}
%
The $x_\ell$ and $x_\mathrm{r}$ positions are defined using the total simulation box length $L_x$ and the factor $p_{\mathrm{mask}}$ as
\[ x_\ell = p_{\mathrm{mask}}L_x;\quad x_\mathrm{r} = (1-p_\mathrm{mask}) L_x. \]
The second option is to have a mask of vanishing value in the domain $\left[ x_\mathrm{\ell}, \, x_\mathrm{r} \right] $. The Krook operator can be used in this case as sink of particles that absorbs particles outside of this domain. The mask is then written as
%
\begin{equation}\label{eq:mask_sink}
 \mathcal{M}_\mathrm{sk}(x) = 1 - \dfrac{1}{2}\left\{ \operatorname{tanh}{\left(\dfrac{x-x_\mathrm{\ell}}{d}\right)} - \operatorname{tanh}{\left(\dfrac{x-x_\mathrm{r}}{d}\right)}  \right\},
\end{equation}
%
%
The $d$ parameter controls the stiffness of the mask function. The target distribution function $g$ is a maxwellian characterized by a constant density $n_\mathrm{t}$ and temperature $T_\mathrm{t}$. It is written in normalized units as 
\[ g(v) = \dfrac{n_\mathrm{t}}{\sqrt{2\pi T_\mathrm{t}} } \operatorname{exp} \left( - \dfrac{v^2}{2 T_\mathrm{t}}  \right). \]
Depending on the values given to $n_\mathrm{t}$ and $T_\mathrm{t}$, the BGK operator will absorb or inject particles and energy. Two different versions of the operator exist: the $\nu$ coefficient can be either constant, or depend on the time and space variables.

\paragraph{Constant Krook operator:} In the case of constant $\nu_\mathrm{a}$ coefficients the differential equation $\partial_t f_\mathrm{a}  = S_\mathrm{BGK}$ is analytical. Its solution is given by
\[ f_a(t+dt) = g_\mathrm{t} + (f_a(t) - g_\mathrm{t})\operatorname{exp} \left( - \nu \mathcal{M} dt \right). \]

\paragraph{Adaptive Krook operator:} It is possible to chose a constant value of $\nu_\mathrm{i}$ and to adapt $\nu_\mathrm{e}$ at each timestep and spatial position such that
\[ \nu_{\mathrm{i}} = \mathrm{cte}; \quad \nu_{\mathrm{e}} = \nu_{\mathrm{i}}\, \dfrac{n_\mathrm{i} - n_\mathrm{t}}{ n_\mathrm{e} - n_\mathrm{t}}. \]
Note here that the $n_a$ quantity is the density of species $a$, and thus depends on space and time. The $\partial_t f_\mathrm{a}  = S_\mathrm{BGK}$ equation is no longer analytical and is solved with an explicit scheme (RK2 scheme for instance).

To verify the implementation of the operator a simple test is conducted, valid for both constant and adaptive $\nu_\mathrm{a}$ coefficients. Integrating the $\partial_t f_\mathrm{i}  = S_\mathrm{BGK}$ equation against the velocity variable yields
\[ \partial_{t} n_\mathrm{i} = - \nu_\mathrm{i} \mathcal{M} \left( n_\mathrm{i} - n_\mathrm{t} \right), \]
which is an equation with analytical solutions. The input parameters of the code allowing for tuning the characteristics of the BGK operator are summarized in Table~\ref{tab:input_para_krook}. Two additional parameters, namely $\texttt{name} \in \left\{ ``source", \, ``sink"\right\} $ and $\texttt{type} \in \left\{ ``constant", \, ``adaptive"\right\} $, are available. The first one allows for for choosing between the masks of Eq.~(\ref{eq:mask_source}) and Eq.~(\ref{eq:mask_sink}). The second one defines the behavior of the $\nu_\mathrm{a}$ coefficients: constant or adaptive.
%
\begin{table}
    \centering
\renewcommand{\arraystretch}{1.5}
\caption{\label{tab:input_para_krook}Krook input parameters significance.}
\vspace{2mm}
%\begin{ruledtabular}
\begin{tabular}{c|c|c|c|c}
    $\texttt{extent}$ & $\texttt{stiffness}$ & $\texttt{amplitude}$ & $\texttt{density}$ &  $\texttt{temperature}$ \\
    \hline
    \hline
  $p_{\mathrm{mask}}$ & $d$ & $\nu_\mathrm{i}$ & $n_\mathrm{t}$ & $T_\mathrm{t}$ \\
\end{tabular}
%\end{ruledtabular}
\end{table}
%







\section{Kinetic source}
\label{sec:kinetic_source}

The source term developed hereafter is inspired by the one currently implemented in GYSELA \cite[Appendix A]{Sarazin_2011}. It allows to inject independently density and energy. It has the following normalized expression
%
\begin{equation}\label{eq:general_form}
   S_\mathrm{sc}(x, v_s) = s_\mathrm{k} \dfrac{\mathcal{M}_\mathrm{sc}(x)}{\int_{0}^{L_x} \mathcal{M}_\mathrm{sc}(x) \, dx} S_\mathrm{v}(v_s) 
\end{equation}
%
The normalized velocity variable $v_s = v/v_{\mathrm{th}_s}$ is simply denoted by $v$ in the following. The mask function $\mathcal{M}_\mathrm{sc}$ defines the spatial extent of the source. It has a hyperbolic tangent expression of the form 
%
\begin{equation*}
  \mathcal{M}_\mathrm{sc}(x)  = \dfrac{1}{2}\left\{ \operatorname{tanh}{\left(\dfrac{x-x_\mathrm{sc}^\mathrm{l}}{d_\mathrm{sc}}\right)} - \operatorname{tanh}{\left(\dfrac{x-x_\mathrm{sc}^\mathrm{r}}{d_\mathrm{sc}}\right)}  \right\} 
\end{equation*}
%
Where $x_\mathrm{sc}^\mathrm{l}$ and $x_\mathrm{sc}^\mathrm{r}$ define the left and right position of the region inside which the source is active. The $d_\mathrm{sc}$ parameter controls the steepness of the source mask. The  $S_\mathrm{v}$ term is written as
%
\begin{equation}\label{eq:sv_expression}
  S_\mathrm{v}(v) = \left\{ s_0\left( \dfrac{3}{2} - \dfrac{v^2}{2 T_\mathrm{sc}} \right) + s_2 \left( -\dfrac{1}{2} + \dfrac{v^2}{2 T_\mathrm{sc}} \right)  \right\} \, \dfrac{1}{\sqrt{2 \pi  T_\mathrm{sc}} } \, e^{- \dfrac{v^2}{2 T_\mathrm{sc}}}
\end{equation}
%
In Eq.~\ref{eq:general_form} the $L_x$ term stands for the simulation box length. The $T_\mathrm{sc}$ parameter defines the source temperature, which is constant in space and time. The  $s_0$, $s_2$ and $s_\mathrm{k}$ are numerical inputs of the code that allows to define the properties of the source. In general we use $s_0 = 1$ so that the magnitude of the source is controlled by the parameter $s_\mathrm{k}$ alone. In this case we have indeed $\int_{}^{} d x \int_{}^{} dv \, S_\mathrm{sc} = s_\mathrm{k}$. Using $s_0 = s_2 = 1$ we recover a Maxwellian source, i.e.\ in this case 
%
\begin{equation}
  S_\mathrm{v}(v) = \dfrac{1}{\sqrt{2\pi T_\mathrm{sc}}} \, e^{- \dfrac{v^2}{2 T_\mathrm{sc}}}
\end{equation}
%
Conversely, by taking $s_2 = 0$ the expression of $S_\mathrm{v}$ has a vanishing first moment, that is to say in this particular case $\int_{}^{} dv\, S_\mathrm{v} = 0$, the source injects energy but no particles. Whatever the values given to $s_0$ and $s_2$ the source is symmetric with respect to $v=0$ therefore it does not inject any net momentum.

\subsection{Derivation of the source}
\label{sub:derivation_of_the_source_expression}

Let $S_\mathrm{v}(v)$ be a general source term. We decompose it on the Hermite polynomials basis. By doing this it becomes possible to adjust independently the amount of particles, momentum and energy that this source injects. For two functions $f$ and $g$ let us first introduce the scalar product
%
\begin{equation}
    \left< f,g\right> = \int_{-\infty}^{+\infty} f(y) g(y) e^{-y^2} dy
\end{equation}
%
The first three Hermite polynomials are written as
%
\begin{adjustwidth}{1.2cm}{1.2cm}
\begin{align*}
    &
    \begin{aligned}
        H_0 = 1
    \end{aligned} 
    &&
    \begin{aligned}
        \left| H_0 \right|^2 = \sqrt{\pi} 
    \end{aligned}\\
    &
    \begin{aligned}
        H_1 = 2X    
    \end{aligned} 
    &&
    \begin{aligned}
        \left| H_1 \right| ^2 = 2 \sqrt{\pi} 
    \end{aligned}\\
    &
    \begin{aligned}
        H_2 = - 2 + 4X^2
    \end{aligned}
    &&
    \begin{aligned}
        \left| H_2 \right| ^2 = 8 \sqrt{\pi} 
    \end{aligned}
\end{align*}
\end{adjustwidth}
%
The Hermite polynomials form an orthogonal basis for the scalar product defined above, i.e.\  $\left< H_h, H_h'\right> = \delta_{h,h'} |H_h|^2$. $\delta_{h,h'}$ is the Kronecker symbol that verifies $\delta_{h,h'} = 1$ if $h=h'$ and $\delta_{h,h'} = 0$ otherwise. Projecting the source term $S_\mathrm{v}$ on this basis gives
%
\begin{equation}\label{eq:source_expansion}
     S_{v}(v) = \sum\limits_{h = 0}^{+\infty} c_h \, H_h \left( \dfrac{v}{\sqrt{2 T_\mathrm{sc}} } \right) e^{- \dfrac{v^2}{2 T_\mathrm{sc}}}
\end{equation}
%
The $c_h$ terms are real valued coefficients. We also introduced here the source temperature $T_\mathrm{sc}$. We now take first three moments of this expansion to retrieve the particle, momentum and energy fluid sources associated with the $S_\mathrm{v}$ source term. Using the orthogonality of the Hermite basis we can show that these fluid sources are expressed as 
%
\begin{align*}
    &
    \begin{aligned}
        \int_{-\infty}^{+\infty} dv\, S_\mathrm{v}(v) = \sqrt{2 T_\mathrm{sc}} \, \sum\limits_{h}^{} \left<H_0, c_h H_h \right> = \sqrt{2 \pi  T_\mathrm{sc}} \, c_0
    \end{aligned} \\
    &
    \begin{aligned}
    \int_{-\infty}^{+\infty} dv\, v S_\mathrm{v}(v) = T_\mathrm{sc} \, \sum\limits_{h}^{} \left<H_1, c_h H_h \right> = 2\sqrt{\pi} T_\mathrm{sc} \, c_1
    \end{aligned} \\
    &
    \begin{aligned}
    \int_{-\infty}^{+\infty} dv\, \dfrac{1}{2} v^2 S_\mathrm{v}(v) =  \sqrt{2\pi } T_\mathrm{sc}^{3/2}  \left( 2c_2 + \dfrac{1}{2}c_0 \right)
    \end{aligned}
\end{align*}
%
Neglecting in the source expansion Eq.~\ref{eq:source_expansion} all the terms for $h>2$ we can obtain a source $\mathcal{S}_n$ that injects particles but no energy nor momentum by setting $c_1 = 0$ and $c_2 = -\tfrac{1}{4}c_0$. This source can be written as
%
\begin{equation}\label{eq:source_density_only}
\mathcal{S}_\mathrm{n}(v) = c_0 \left( \dfrac{3}{2} - \dfrac{v^2}{2 T_\mathrm{sc}} \right) e^{- \dfrac{v^2}{2 T_\mathrm{sc}}} 
\end{equation}
%
Conversely, a source that injects only momentum but no net particles nor energy is defined by $c_0 = 0$ and $c_2 = 0$. It is expressed as 
%
\begin{equation}\label{eq:source_momentum_only}
\mathcal{S}_\mathrm{u}(v) = c_1 \sqrt{ \dfrac{2}{T_\mathrm{sc}}}  e^{- \dfrac{v^2}{2 T_\mathrm{sc}}} 
\end{equation}
%
Lastly, a source that injects only energy can be obtained with $c_0 = 0$ and $c_1 = 0$. It is written as 
%
\begin{equation}\label{eq:source_energy_only}
\mathcal{S}_\mathrm{h}(v) = 2c_2 \left( -1 + \dfrac{v^2}{T_\mathrm{sc}} \right)   e^{- \dfrac{v^2}{2 T_\mathrm{sc}}} 
\end{equation}
%
We construct our source $S_\mathrm{v}$ using the three independent sources above as $S_\mathrm{v} = \mathcal{S}_\mathrm{n} + \mathcal{S}_\mathrm{u} + \mathcal{S}_\mathrm{h}$. By tuning the $c_0$, $c_1$ and $c_2$ parameter we can inject independently particles, momentum and energy in the plasma. In practice we always take $c_1=0$, i.e.\ the source does not inject any net momentum. Additionally by using $s_0 = \sqrt{2 \pi T_\mathrm{sc}}c_0 $ and $s_2 = \sqrt{2 \pi T_\mathrm{sc}}c_2 $ as input parameters in the code we are left with Eq.~\ref{eq:sv_expression} for the expression of $S_\mathrm{v}$.

\newpage
\printbibliography

\end{document}
